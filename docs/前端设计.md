## 需求

**核心**：适配后端

前端显示的页面应该如下：

### Page1: 登录页面 （login.html）

一个经典的登录页面，只显示一个表单，需要两个字段：密码和账号。

### Page2: 主控制面板（dashboard.html）

主控制页面，可控制以下功能：

1. 修改登录密码
2. **录入人脸**
3. **人脸管理面板**`
4. **一键开门**
5. 添加传统密码（不一定实现）
6. 重置传统密码（不一定实现）

以上内容使用 button 形式显示一列，从上到下，占手机屏幕宽度的 2/3 。

除此之外，不需要显示其他内容

### Page3: 人脸录入页面（face_input.html）

调用 ov5695 摄像头，将拍到的画面传到手机屏幕上。

三分之二的屏幕显示摄像头的内容（即 API `/api/video_stream`）。

剩下的页面显示：

- 一个输入框：给用户输入录入人脸的用户姓名
- 一个按钮：确定录入，点击后触发 API `/api/face/capture`，触发录入

**录入成功后返回信息，通知前端录入是否完成。（后端似乎没有实现相关的 GET 请求）**

### Page4: 人脸管理面板（face_dashboard.html）

实现以下功能：

1. 获取已录入人脸的用户列表
2. **重置人脸数据库**
3. 删除指定用户的人脸录入数据

使用三个 button 显示。

**同样操作结束后需要通知前端页面显示操作是否成功（后端似乎没有实现相关的 GET 请求）**

### Page5: 已经录入人脸的用户列表（face_registered.html)

以一个列表显示已经录入人脸的用户。

## 核心架构

*   **技术栈**：原生 HTML + Jinja2 模板引擎 + Bootstrap 5 CSS框架 + 原生 JavaScript (Fetch API)
*   **布局模式**：所有页面继承自 `base.html`，通过 Jinja2 的 `{% block content %}` 注入内容，实现导航栏和页脚的复用
*   **响应反馈**：前端**不需要**额外的 GET 请求来查询操作是否成功。后端的 POST/DELETE 接口会直接返回 JSON 格式的响应（如 `{"status": "success", "msg": "录入成功"}`），前端 JS 捕获该响应并弹出提示即可

## 工具使用

基于项目架构（RK3568 AP 模式 + FastAPI）和需求，采用**原生 HTML + Jinja2 模板引擎 + Bootstrap （本地静态资源）**的方式

### Jinja2

Jinja2 是 Python 的一个库。它的作用是让你在写 HTML 的时候，可以留出“空位”，然后用 Python 把数据填进去。

**举个例子：**

第一步：写一个带“空位”的 HTML 文件 (log.html)

```html
<h1>门禁日志</h1>
<ul>
  <!-- {% ... %} 是 Jinja2 的魔法指令，意思是在这里搞个循环 -->
  {% for log in logs %}
      <!-- {{ ... }} 意思是把变量填进去 -->
      <li> {{ log.user }} 在 {{ log.time }} 开门了 </li>
  {% endfor %}
</ul>
```

第二步：在 FastAPI (Python) 里把数据传进去

```bash
@app.get("/logs")
def get_logs(request: Request):
    # 这是您从数据库查出来的数据
    data = [
        {"user": "张三", "time": "10:00"},
        {"user": "李四", "time": "10:05"}
    ]
    # Jinja2 自动把 data 填入 log.html
    return templates.TemplateResponse("log.html", {"request": request, "logs": data})
```

最终用户看到的网页：

```bash
<h1>门禁日志</h1>
<ul>
      <li> 张三 在 10:00 开门了 </li>
      <li> 李四 在 10:05 开门了 </li>
</ul>
```

**总结：** Jinja2 **在 Python 后端就能决定网页长什么样**，不需要去学前端复杂的渲染逻辑。

### Bootstrap 5

Bootstrap 是一套别人写好的 CSS 样式文件（.css）和一些简单的脚本（.js）。



## 页面详细设计

### Page1: 登录页面 (`templates/login.html`)

*   **功能**: 管理员身份验证
*   **UI 布局**:
    *   屏幕垂直居中显示一个卡片 (Card)
    *   包含两个 `input` 框：账号 (`username`)、密码 (`password`)
    *   一个“登录”按钮 (`btn-primary`)
*   **交互逻辑**:
    *   点击登录 -> JS 发送 `POST /api/login`
    *   **成功**: 后端返回 Token，JS 将其存入 `localStorage` 或 Cookie，并跳转至 `dashboard.html`
    *   **失败**: 弹出 Alert 提示“账号或密码错误”

### Page2: 主控制面板 (`templates/dashboard.html`)

*   **功能**: 系统功能的中央入口
*   **UI 布局**:
    *   使用 Bootstrap 的 Grid 系统，内容居中，宽度占手机屏幕 2/3 (`col-8`)
    *   使用垂直按钮组 (`d-grid gap-3`) 排列以下功能
*   **按钮列表**:
    1.  **一键开门**:
        *   **样式**: `btn-success` (绿色，醒目)
        *   **交互**: 点击触发 JS 函数 `unlockDoor()` -> 发送 `POST /api/unlock`
        *   **反馈**: 接收后端 JSON 返回，显示 Toast 或 Alert 提示“正在开门...”
    2.  **录入人脸**:
        *   **样式**: `btn-primary`
        *   **交互**: 点击跳转 `href="/face_input"` (对应 Page3)
    3.  **人脸管理**:
        *   **样式**: `btn-info`
        *   **交互**: 点击跳转 `href="/face_dashboard"` (对应 Page4)
    4.  **修改登录密码**:
        *   **样式**: `btn-secondary`
        *   **交互**: 弹出 Bootstrap Modal (模态框) 输入新密码 -> 发送 `POST /api/change_login_password`
    5.  **添加/重置传统密码** (预留):
        *   **样式**: `btn-outline-secondary` (虚线框，表示次要或未实现)

### Page3: 人脸录入页面 (`templates/face_input.html`)

*   **功能**: 实时预览并抓拍人脸
*   **UI 布局**:
    *   **上部 (2/3)**: 视频流显示区域
        *   代码: `<img src="/api/video_stream" class="img-fluid rounded shadow">`
        *   *注*: 直接引用后端流地址，无需 JS 介入即可显示动态画面
    *   **下部 (1/3)**: 操作区
        *   输入框: `input` (Placeholder: "请输入姓名")
        *   按钮: "确定录入" (`btn-danger`)
*   **交互逻辑**:
    
    *   用户点击“确定录入”。
    *   JS 获取输入框内容，发送 `POST /api/face/capture`，数据体为 `{"username": "xxx"}`
    *   **关于返回信息**：**后端接口已设计为直接返回结果**
        
        *   JS 使用 `fetch` 等待响应：
        ```javascript
        fetch('/api/face/capture', { ... })
        .then(response => response.json())
        .then(data => {
            if(data.status === "success") {
                alert("录入成功！"); // 直接利用后端的返回
                inputField.value = ""; // 清空输入框
            } else {
                alert("失败: " + data.msg);
            }
        })
        ```

### Page4: 人脸管理面板 (`templates/face_dashboard.html`)

*   **功能**: 人脸库维护功能的二级菜单
*   **UI 布局**:
    *   与 Page2 类似，垂直排列两个按钮
*   **按钮列表**:
    1.  **查看用户列表**:
        *   **交互**: 点击跳转 `href="/face_list"` (对应 Page5)
    3.  **重置人脸数据库 (危险操作)**:
        *   **样式**: `btn-danger` (红色)。
        *   **交互**: 点击 -> 弹出 `confirm("确定要清空所有人脸数据吗？")` -> 确认后发送 `DELETE /api/face/reset`。
        *   **反馈**: 接收后端 JSON 响应，提示“重置成功”。

### Page5: 已录入用户列表 (`templates/face_registered.html`)

*   **功能**: 展示与删除特定用户

*   **UI 布局**:
    *   一个 Bootstrap 表格 (`table table-striped`)
    *   表头: ID, 姓名, 录入时间, 操作

*   **数据加载逻辑**：

    后端 API 直接渲染模板并传入 `users` 列表数据 (Jinja2 循环 `{% for user in users %}` 生成表格行)

*   **操作列 (删除指定用户)**：

    *   每一行都有一个删除小按钮 (`btn-sm btn-outline-danger`)
    *   **交互**: 点击按钮 -> 获取该行用户名 -> 发送 `DELETE /api/face/{username}`
    *   **反馈**: 接收后端 JSON 响应 (success) -> JS 移除表格中的对应行 -> 提示“删除成功”

## 工具安装

```bash
pip install jinja2
```

另一个静态渲染文件我已经下载好，位于fronted\static，可直接使用。

例如：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能门禁系统</title>
    
    <!-- 引入 Bootstrap CSS (Jinja2 会自动去 /static/css/ 找) -->
    <link href="{{ url_for('static', path='/css/bootstrap.min.css') }}" rel="stylesheet">
</head>
<body>
    
    <!-- 页面内容 -->
    {% block content %}{% endblock %}

    <!-- 引入 Bootstrap JS Bundle -->
    <script src="{{ url_for('static', path='/js/bootstrap.bundle.min.js') }}"></script>
</body>
</html>
```

