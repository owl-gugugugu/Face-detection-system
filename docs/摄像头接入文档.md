# RK3568 æ‘„åƒå¤´æ¥å…¥å®Œæ•´æŒ‡å—

> **æ–‡æ¡£è¯´æ˜**ï¼šæœ¬æ–‡æ¡£æ•´åˆäº†å®Œæ•´çš„æ‘„åƒå¤´è°ƒè¯•è¿‡ç¨‹ï¼ŒåŒ…å«æ‰€æœ‰ç»ˆç«¯è¾“å‡ºå’ŒæŠ¥é”™ä¿¡æ¯ã€‚å¯æ›¿ä»£ `log.md` å’Œ `test_log.md`ã€‚

## ç›®å½•
- [1. é—®é¢˜èƒŒæ™¯](#1-é—®é¢˜èƒŒæ™¯)
- [2. OV5695 æ‘„åƒå¤´æ¥å…¥å¤±è´¥](#2-ov5695-æ‘„åƒå¤´æ¥å…¥å¤±è´¥)
- [3. USB æ‘„åƒå¤´æ¥å…¥](#3-usb-æ‘„åƒå¤´æ¥å…¥)
- [4. æµ‹è¯•ä¸éªŒè¯](#4-æµ‹è¯•ä¸éªŒè¯)
- [5. æ•…éšœæ’æŸ¥æ€»ç»“](#5-æ•…éšœæ’æŸ¥æ€»ç»“)

---

## 1. é—®é¢˜èƒŒæ™¯

æœ¬é¡¹ç›®æœ€åˆè®¡åˆ’ä½¿ç”¨ **OV5695 MIPI-CSI æ‘„åƒå¤´** é€šè¿‡ RK3568 çš„ç¡¬ä»¶ ISP æ¥å£å®ç°äººè„¸è¯†åˆ«ã€‚ä½†åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°äº†ç¡¬ä»¶æ•…éšœï¼Œæœ€ç»ˆåˆ‡æ¢åˆ° **USB æ‘„åƒå¤´**æ–¹æ¡ˆã€‚

**è°ƒè¯•æ—¶é—´**ï¼š2025-12-25

æœ¬æ–‡æ¡£è®°å½•ï¼š
- âœ… å®Œæ•´çš„æ’æŸ¥è¿‡ç¨‹ï¼ˆè®¾å¤‡æ ‘ã€I2Cã€GPIOã€é©±åŠ¨ï¼‰
- âœ… æ‰€æœ‰æŠ¥é”™ä¿¡æ¯ï¼ˆdmesgã€i2cdetectã€v4l2-ctlï¼‰
- âœ… USBæ‘„åƒå¤´åˆ‡æ¢æ–¹æ¡ˆ
- âœ… æ€§èƒ½æµ‹è¯•ç»“æœï¼ˆOpenCV 30 FPSï¼‰

---

## 2. OV5695 æ‘„åƒå¤´æ¥å…¥å¤±è´¥

### 2.1 åˆå§‹ç—‡çŠ¶

**é—®é¢˜æè¿°**ï¼š
- OV5695 æ‘„åƒå¤´é€šè¿‡ MIPI æ’çº¿è¿æ¥åˆ° RK3568
- ç³»ç»Ÿèƒ½æ£€æµ‹åˆ°è®¾å¤‡èŠ‚ç‚¹ `/dev/video0`ï¼Œä½†æ— æ³•æ­£å¸¸å·¥ä½œ

### 2.2 ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥è®¾å¤‡æ ‘é…ç½®

#### æ£€æŸ¥ I2C æ€»çº¿çŠ¶æ€

```bash
# æŸ¥çœ‹æ‘„åƒå¤´åœ¨è®¾å¤‡æ ‘ä¸­çš„é…ç½®
ls /sys/firmware/devicetree/base/i2c*/ov5695*
```

**è¾“å‡º**ï¼š
```
clock-names  name       pinctrl-names  pwdn-gpios   rockchip,camera-module-facing     rockchip,camera-module-name
clocks       phandle    port           reg          rockchip,camera-module-index      status
compatible   pinctrl-0  power-domains  reset-gpios  rockchip,camera-module-lens-name
```

âœ… **è®¾å¤‡æ ‘é…ç½®å­˜åœ¨**

#### æ£€æŸ¥è®¾å¤‡çŠ¶æ€

```bash
cat /sys/firmware/devicetree/base/i2c@fe5b0000/ov5695@36/status
```

**è¾“å‡º**ï¼š
```
okay
```

âœ… **è®¾å¤‡çŠ¶æ€ä¸º okay**

#### æ£€æŸ¥ I2C åœ°å€

```bash
xxd /sys/firmware/devicetree/base/i2c@fe5b0000/ov5695@36/reg
```

**è¾“å‡º**ï¼š
```
00000000: 0000 0036                                ...6
```

âœ… **I2C åœ°å€ä¸º 0x36ï¼ˆæ­£ç¡®ï¼‰**

---

### 2.3 ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥é©±åŠ¨åŠ è½½

#### æŸ¥çœ‹é©±åŠ¨æ—¥å¿—

```bash
dmesg | grep ov5695
```

**è¾“å‡º**ï¼š
```
[    2.948339] ov5695 2-0036: driver version: 00.01.04
[    2.948435] ov5695 2-0036: Looking up avdd-supply from device tree
[    2.948448] ov5695 2-0036: Looking up avdd-supply property in node /i2c@fe5b0000/ov5695@36 failed
[    2.948483] ov5695 2-0036: 2-0036 supply avdd not found, using dummy regulator
[    2.948607] ov5695 2-0036: Linked as a consumer to regulator.0
[    2.948628] ov5695 2-0036: Looking up dovdd-supply from device tree
[    2.948639] ov5695 2-0036: Looking up dovdd-supply property in node /i2c@fe5b0000/ov5695@36 failed
[    2.948658] ov5695 2-0036: 2-0036 supply dovdd not found, using dummy regulator
[    2.948714] ov5695 2-0036: Looking up dvdd-supply from device tree
[    2.948725] ov5695 2-0036: Looking up dvdd-supply property in node /i2c@fe5b0000/ov5695@36 failed
[    2.948742] ov5695 2-0036: 2-0036 supply dvdd not found, using dummy regulator
[    3.972253] ov5695 2-0036: Unexpected sensor id(000000), ret(-5)
```

ğŸ”´ **å…³é”®é”™è¯¯**ï¼š
```
Unexpected sensor id(000000), ret(-5)
```

**é”™è¯¯åˆ†æ**ï¼š
- é©±åŠ¨å°è¯•é€šè¿‡ I2C è¯»å–ä¼ æ„Ÿå™¨ ID
- è¿”å›å€¼ä¸º `000000`ï¼ˆåº”è¯¥è¿”å› OV5695 çš„èŠ¯ç‰‡ IDï¼‰
- é”™è¯¯ä»£ç  `-5` è¡¨ç¤º I/O é”™è¯¯

---

### 2.4 ç¬¬ä¸‰æ­¥ï¼šI2C æ€»çº¿æ‰«æ

#### å®‰è£… i2c-tools

```bash
sudo apt-get install i2c-tools
```

#### åˆ—å‡º I2C æ€»çº¿

```bash
ls -l /dev/i2c-*
```

**è¾“å‡º**ï¼š
```
crw-rw---- 1 root i2c 89, 0 12æœˆ 25 07:58 /dev/i2c-0
crw-rw---- 1 root i2c 89, 1 12æœˆ 25 07:58 /dev/i2c-1
crw-rw---- 1 root i2c 89, 2 12æœˆ 25 07:58 /dev/i2c-2
crw-rw---- 1 root i2c 89, 4 12æœˆ 25 07:58 /dev/i2c-4
crw-rw---- 1 root i2c 89, 5 12æœˆ 25 07:58 /dev/i2c-5
crw-rw---- 1 root i2c 89, 6 12æœˆ 25 07:58 /dev/i2c-6
```

#### æ‰«æ I2C-2ï¼ˆæ‘„åƒå¤´åº”è¯¥åœ¨è¿™ä¸ªæ€»çº¿ä¸Šï¼‰

```bash
sudo i2cdetect -y 2
```

**è¾“å‡º**ï¼š
```
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --
```

ğŸ”´ **è‡´å‘½é—®é¢˜**ï¼šåœ°å€ `0x36` ä½ç½®æ˜¾ç¤º `--`ï¼Œè¡¨ç¤º **I2C æ€»çº¿ä¸Šæ²¡æœ‰æ£€æµ‹åˆ°è®¾å¤‡**ï¼

#### æ‰«æå…¶ä»– I2C æ€»çº¿

```bash
sudo i2cdetect -y 0
```

**è¾“å‡º**ï¼š
```
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- UU -- -- --
20: UU -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
...
```

```bash
sudo i2cdetect -y 5
```

**è¾“å‡º**ï¼š
```
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- UU -- -- -- -- -- -- -- -- -- -- -- -- --
...
```

**ç»“è®º**ï¼šåœ¨æ‰€æœ‰ I2C æ€»çº¿ä¸Šéƒ½**æ²¡æœ‰æ£€æµ‹åˆ°åœ°å€ 0x36 çš„è®¾å¤‡**ã€‚

---

### 2.5 ç¬¬å››æ­¥ï¼šæ£€æŸ¥ GPIO æ§åˆ¶

#### æŸ¥çœ‹ GPIO çŠ¶æ€

```bash
sudo cat /sys/kernel/debug/gpio
```

**å®Œæ•´è¾“å‡º**ï¼š
```
gpiochip0: GPIOs 0-31, parent: platform/fdd60000.gpio, gpio0:
 gpio-6   (                    |vcc5v0_host         ) out hi
 gpio-15  (                    |work                ) out hi
 gpio-16  (                    |hpd                 ) in  lo
 gpio-17  (                    |vcc_camera          ) out hi
 gpio-22  (                    |rs485_ctl           ) out hi
 gpio-23  (                    |vcc3v3_lcd0_n       ) out lo
 gpio-28  (                    |vcc3v3_pcie         ) out lo
 gpio-29  (                    |vcc3v3_vga          ) out hi

gpiochip1: GPIOs 32-63, parent: platform/fe740000.gpio, gpio1:

gpiochip2: GPIOs 64-95, parent: platform/fe750000.gpio, gpio2:
 gpio-73  (                    |bt_default_rts      ) out hi
 gpio-94  (                    |reset               ) out hi

gpiochip3: GPIOs 96-127, parent: platform/fe760000.gpio, gpio3:
 gpio-96  (                    |bt_default_reset    ) out hi
 gpio-97  (                    |bt_default_wake_host) in  lo
 gpio-98  (                    |bt_default_wake     ) out hi
 gpio-102 (                    |vcc5v0_otg          ) out lo
 gpio-104 (                    |mdio-reset          ) out hi
 gpio-111 (                    |mdio-reset          ) out hi
 gpio-114 (                    |Headphone detection ) in  hi
 gpio-118 (                    |vcc3v3_lcd1_n       ) out lo

gpiochip4: GPIOs 128-159, parent: platform/fe770000.gpio, gpio4:

gpiochip5: GPIOs 511-511, parent: platform/rk805-pinctrl, rk817-gpio, can sleep:
```

âœ… **æ‘„åƒå¤´ç”µæº GPIOï¼ˆgpio-17ï¼‰çŠ¶æ€ä¸º HIGHï¼ˆå·²ä¾›ç”µï¼‰**

#### æŸ¥çœ‹ reset å’Œ pwdn GPIO

```bash
cat /sys/firmware/devicetree/base/i2c@fe5b0000/ov5695@36/reset-gpios | xxd
```

**è¾“å‡º**ï¼š
```
00000000: 0000 0081 0000 001c 0000 0001            ............
```

```bash
cat /sys/firmware/devicetree/base/i2c@fe5b0000/ov5695@36/pwdn-gpios | xxd
```

**è¾“å‡º**ï¼š
```
00000000: 0000 0081 0000 001d 0000 0000            ............
```

âœ… **GPIO é…ç½®å­˜åœ¨**

---

### 2.6 å°è¯•é‡æ–°åŠ è½½é©±åŠ¨

```bash
sudo modprobe -r ov5695
```

**è¾“å‡º**ï¼šæ— é”™è¯¯

```bash
sudo modprobe ov5695
```

**è¾“å‡º**ï¼š
```
modprobe: FATAL: Module ov5695 not found in directory /lib/modules/4.19.232
```

ğŸ”´ **é©±åŠ¨æ¨¡å—ä¸å­˜åœ¨æˆ–å·²å†…ç½®åˆ°å†…æ ¸ä¸­**ï¼ˆå†…ç½®åˆ™ä¸éœ€è¦ modprobeï¼‰

---

### 2.7 æ£€æŸ¥ video è®¾å¤‡

```bash
ls -l /dev/video*
```

**è¾“å‡º**ï¼š
```
crw-rw----+ 1 root video 81, 0 12æœˆ 25 07:58 /dev/video0
crw-rw----+ 1 root video 81, 1 12æœˆ 25 07:58 /dev/video1
crw-rw----+ 1 root video 81, 2 12æœˆ 25 07:58 /dev/video2
crw-rw----+ 1 root video 81, 3 12æœˆ 25 07:58 /dev/video3
crw-rw----+ 1 root video 81, 4 12æœˆ 25 07:58 /dev/video4
crw-rw----+ 1 root video 81, 5 12æœˆ 25 07:58 /dev/video5
crw-rw----+ 1 root video 81, 6 12æœˆ 25 07:58 /dev/video6
crw-rw----+ 1 root video 81, 7 12æœˆ 25 07:58 /dev/video7
crw-rw----+ 1 root video 81, 8 12æœˆ 25 07:58 /dev/video8
lrwxrwxrwx  1 root root      6 12æœˆ 25 07:58 /dev/video-camera0 -> video0
```

âœ… **video è®¾å¤‡èŠ‚ç‚¹å­˜åœ¨**ï¼ˆè¿™äº›æ˜¯ ISP ç®¡é“èŠ‚ç‚¹ï¼Œä¸æ˜¯æ‘„åƒå¤´ä¼ æ„Ÿå™¨ï¼‰

---

### 2.8 æ ¹æœ¬åŸå› è¯Šæ–­

**ç»¼åˆåˆ†æ**ï¼š

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | ç»“è®º |
|--------|------|------|
| è®¾å¤‡æ ‘é…ç½® | âœ… æ­£å¸¸ | è½¯ä»¶é…ç½®æ­£ç¡® |
| è®¾å¤‡çŠ¶æ€ | âœ… okay | é©±åŠ¨å·²å¯ç”¨ |
| I2C åœ°å€é…ç½® | âœ… 0x36 | é…ç½®æ­£ç¡® |
| é©±åŠ¨åŠ è½½ | âš ï¸ åŠ è½½ä½†æ£€æµ‹å¤±è´¥ | é©±åŠ¨å·¥ä½œä½†æ— æ³•é€šä¿¡ |
| I2C æ‰«æ | âŒ æœªæ£€æµ‹åˆ°è®¾å¤‡ | **ç¡¬ä»¶æ— å“åº”** |
| GPIO ç”µæº | âœ… å·²ä¾›ç”µ | ç”µæºæ§åˆ¶æ­£å¸¸ |
| ä¼ æ„Ÿå™¨ ID | âŒ è¿”å› 000000 | **I2C é€šä¿¡å¤±è´¥** |

**æœ€ç»ˆç»“è®º**ï¼š

ğŸ”´ OV5695 æ‘„åƒå¤´ç¡¬ä»¶æ•…éšœ
   - I2C æ€»çº¿æ— æ³•æ£€æµ‹åˆ°è®¾å¤‡ï¼ˆåœ°å€ 0x36 æ— å“åº”ï¼‰
   - å¯èƒ½åŸå› ï¼šæ‘„åƒå¤´æ¨¡å—æŸåã€æ’çº¿æ¥è§¦ä¸è‰¯ã€MIPI æ¥å£é—®é¢˜
   - è§£å†³æ–¹æ¡ˆï¼šæ›´æ¢æ‘„åƒå¤´æˆ–åˆ‡æ¢åˆ° USB æ‘„åƒå¤´

---

## 3. USB æ‘„åƒå¤´æ¥å…¥

### 3.1 ç¡¬ä»¶ä¿¡æ¯

**æ›´æ¢çš„ USB æ‘„åƒå¤´**ï¼š
- å“ç‰Œï¼šå››å·å¨é‘«è§†ç•Œç§‘æŠ€æœ‰é™å…¬å¸ S-TUE æ™Ÿæ‚¦
- å‹å·ï¼šSY011HD-V1
- å‚æ•°ï¼š
  - ç”µæºï¼šUSB 5V
  - åˆ†è¾¨ç‡ï¼šAHD 1080P
  - å¸§ç‡ï¼š60 FPS
  - åè®®ï¼šUVCï¼ˆå…é©±åŠ¨ï¼‰

### 3.2 æ’å…¥ USB æ‘„åƒå¤´

#### åˆæ¬¡æ’å…¥æµ‹è¯•

**æ“ä½œ**ï¼šå°†æ‘„åƒå¤´æ’å…¥ RK3568 çš„ USB 2.0 æ¥å£

```bash
lsusb
```

**è¾“å‡º**ï¼š
```
Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 002: ID 0bda:d723 Realtek Semiconductor Corp. 802.11n WLAN Adapter
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

ğŸ”´ **æœªæ£€æµ‹åˆ°æ‘„åƒå¤´ï¼**

**ç»§ç»­æ£€æŸ¥**ï¼š
```bash
dmesg | grep -i usb
```

**è¾“å‡º**ï¼ˆä»…æ˜¾ç¤ºè“ç‰™ç›¸å…³ï¼‰ï¼š
```
[   11.340992] rtk_btusb: read_ver_rsp->lmp_subver = 0x37de
[   11.341000] rtk_btusb: read_ver_rsp->hci_rev = 0x8299
[   11.341002] rtk_btusb: patch_entry->lmp_sub = 0x8723
[   11.341018] rtk_btusb: Rtk patch end 0
[   11.341021] rtk_btusb: btusb_open set HCI_RUNNING
[   11.341080] rtk_btusb: btusb_open end
[   11.385981] rtk_btusb: btusb_notify: hci0 evt 3
```

ğŸ”´ **é—®é¢˜**ï¼šè¯¥USBæ¥å£å¯èƒ½ä¾›ç”µä¸è¶³æˆ–ç¡¬ä»¶æ•…éšœ

---

### 3.3 æ›´æ¢ USB æ¥å£

**æ“ä½œ**ï¼šå°†æ‘„åƒå¤´æ›´æ¢åˆ°å¦ä¸€ä¸ª USB 2.0 æ¥å£

#### å®æ—¶ç›‘æ§å†…æ ¸æ—¥å¿—

```bash
dmesg -w
```

**æ’å…¥åçš„è¾“å‡º**ï¼š
```
[  491.063156] usb 2-1: Product: USB CAMERA
[  491.063160] usb 2-1: Manufacturer: Generic
[  491.063164] usb 2-1: SerialNumber: EP.20CC54K01
[  491.068472] uvcvideo: Found UVC 1.00 device USB CAMERA (10bb:2b08)
```

âœ… **æ‘„åƒå¤´æˆåŠŸè¯†åˆ«ï¼**

**å…³é”®ä¿¡æ¯**ï¼š
- äº§å“åï¼šUSB CAMERA
- åˆ¶é€ å•†ï¼šGeneric
- åºåˆ—å·ï¼šEP.20CC54K01
- VID:PIDï¼š10bb:2b08
- é©±åŠ¨ï¼šuvcvideoï¼ˆUVC åè®®ï¼‰

#### éªŒè¯ lsusb

```bash
lsusb
```

**è¾“å‡º**ï¼š
```
Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 002 Device 003: ID 10bb:2b08 TM Technology, Inc. USB CAMERA
Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 002: ID 0bda:d723 Realtek Semiconductor Corp. 802.11n WLAN Adapter
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

âœ… **USB CAMERA å·²è¯†åˆ«ï¼ˆBus 002 Device 003ï¼‰**

---

### 3.4 æŸ¥æ‰¾è®¾å¤‡èŠ‚ç‚¹

```bash
v4l2-ctl --list-devices
```

**è¾“å‡º**ï¼š
```
USB CAMERA: USB CAMERA (usb-fd880000.usb-1):
        /dev/video9
        /dev/video10
```

âœ… **æ‘„åƒå¤´æ˜ å°„åˆ° /dev/video9 å’Œ /dev/video10**

**è¯´æ˜**ï¼š
- `/dev/video9`ï¼šè§†é¢‘æµèŠ‚ç‚¹ï¼ˆä¸»è¦ä½¿ç”¨ï¼‰
- `/dev/video10`ï¼šå…ƒæ•°æ®èŠ‚ç‚¹

---

## 4. æµ‹è¯•ä¸éªŒè¯

### 4.1 ä½¿ç”¨æµ‹è¯•è„šæœ¬

#### è¿è¡ŒåŸºç¡€æµ‹è¯•ï¼ˆè·³è¿‡ GStreamerï¼‰

```bash
cd /home/topeet/face_detection_system/backend/scripts
python3 test_camera.py --index 9 --skip-gstreamer
```

**è¾“å‡º**ï¼š
```
============================================================
  OV5695 æ‘„åƒå¤´æµ‹è¯•
============================================================
æµ‹è¯•æ—¶é—´: 2025-12-25 08:56:55
ç›®æ ‡åˆ†è¾¨ç‡: 640x480
è¾“å‡ºç›®å½•: /home/topeet/face_detection_system/camera_test_output

============================================================
  1. æ£€æŸ¥ Video è®¾å¤‡
============================================================
æ‰¾åˆ° 12 ä¸ª video è®¾å¤‡ï¼š
  /dev/video-camera0: è·³è¿‡ï¼ˆç¬¦å·é“¾æ¥æˆ–éæ ‡å‡†è®¾å¤‡ï¼‰
  /dev/video0: Driver name      : rkisp_v5
  /dev/video0: Card type        : rkisp_mainpath
  /dev/video1: Driver name      : rkisp_v5
  /dev/video1: Card type        : rkisp_selfpath
  /dev/video2: Driver name      : rkisp_v5
  /dev/video2: Card type        : rkisp_rawwr0
  /dev/video3: Driver name      : rkisp_v5
  /dev/video3: Card type        : rkisp_rawwr2
  /dev/video4: Driver name      : rkisp_v5
  /dev/video4: Card type        : rkisp_rawwr3
  /dev/video5: Driver name      : rkisp_v5
  /dev/video5: Card type        : rkisp_rawrd0_m
  /dev/video6: Driver name      : rkisp_v5
  /dev/video6: Card type        : rkisp_rawrd2_s
  /dev/video7: Driver name      : rkisp_v5
  /dev/video7: Card type        : rkisp-statistics
  /dev/video8: Driver name      : rkisp_v5
  /dev/video8: Card type        : rkisp-input-params
  /dev/video9: Driver name      : uvcvideo
  /dev/video9: Card type        : USB CAMERA: USB CAMERA
  /dev/video10: Driver name      : uvcvideo
  /dev/video10: Card type        : USB CAMERA: USB CAMERA
[âœ“ PASS] Video è®¾å¤‡æ£€æµ‹
      æ‰¾åˆ° 11 ä¸ªè®¾å¤‡

============================================================
  2. æµ‹è¯• OpenCV æ¨¡å¼ (ç´¢å¼• 9)
============================================================
æ­£åœ¨æ‰“å¼€æ‘„åƒå¤´ (ç´¢å¼• 9)...
[âœ“ PASS] OpenCV æ‰“å¼€æ‘„åƒå¤´
è¯·æ±‚åˆ†è¾¨ç‡: 640x480
å®é™…åˆ†è¾¨ç‡: 640x480
å¸§ç‡: 30.0 FPS
é¢„çƒ­æ‘„åƒå¤´...
æ•è·æµ‹è¯•å›¾åƒ...
[âœ“ PASS] æ•è·å›¾åƒ
      å›¾åƒå°ºå¯¸: 640x480
å›¾åƒå¹³å‡äº®åº¦: 36.20
[âœ“ PASS] å›¾åƒè´¨é‡æ£€æŸ¥
      äº®åº¦æ­£å¸¸
[âœ“ PASS] ä¿å­˜å›¾åƒ
      æ–‡ä»¶: opencv_test_20251225_085656_640x480.jpg

============================================================
  3. GStreamer æµ‹è¯•
============================================================
è·³è¿‡ GStreamer æµ‹è¯•

============================================================
  4. æ€§èƒ½æµ‹è¯• - è¿ç»­æ•è· 5 ç§’
============================================================
è¿ç»­æ•è· 5 ç§’...
æ•è·å¸§æ•°: 151
å®é™… FPS: 30.11
[âœ“ PASS] æ€§èƒ½æµ‹è¯•
      FPS è‰¯å¥½ (30.11)
ä¿å­˜æœ€åä¸€å¸§: continuous_test_20251225_085702_640x480.jpg

============================================================
  æµ‹è¯•æ€»ç»“
============================================================
Video è®¾å¤‡æ£€æµ‹:   âœ“
OpenCV æ¨¡å¼:      âœ“
GStreamer æ¨¡å¼:   âŠ˜
æ€§èƒ½æµ‹è¯•:         âœ“

ä¿å­˜çš„æµ‹è¯•å›¾åƒ (2 å¼ ):
  continuous_test_20251225_085702_640x480.jpg (56.1 KB)
  opencv_test_20251225_085656_640x480.jpg (61.4 KB)

============================================================
  å»ºè®®
============================================================
âœ“ OpenCV æ¨¡å¼å·¥ä½œæ­£å¸¸ï¼Œå»ºè®®ä½¿ç”¨æ­¤æ¨¡å¼
  é…ç½®: CAMERA_MODE = 'opencv' æˆ– 'auto'
```

âœ… **OpenCV æ¨¡å¼æµ‹è¯•é€šè¿‡**

---

### 4.2 GStreamer æµ‹è¯•

#### è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆåŒ…æ‹¬ GStreamerï¼‰

```bash
python3 test_camera.py --width 640 --height 480 --index 9
```

**GStreamer éƒ¨åˆ†è¾“å‡º**ï¼š
```
============================================================
  3. æµ‹è¯• GStreamer æ¨¡å¼ (ç´¢å¼• 9)
============================================================
GStreamer ç®¡é“:
  rkisp device=/dev/video9 io-mode=1 ! video/x-raw,format=NV12,width=640,height=480,framerate=30/1 ! videoconvert ! video/x-raw,format=BGR ! appsink
æ­£åœ¨æ‰“å¼€æ‘„åƒå¤´ (GStreamer)...
[âœ— FAIL] GStreamer æ‰“å¼€æ‘„åƒå¤´
      æ— æ³•æ‰“å¼€ï¼ˆå¯èƒ½ç³»ç»Ÿä¸æ”¯æŒ GStreamer æˆ– rkispï¼‰

============================================================
  4. æ€§èƒ½æµ‹è¯• - è¿ç»­æ•è· 5 ç§’
============================================================
è¿ç»­æ•è· 5 ç§’...
æ•è·å¸§æ•°: 151
å®é™… FPS: 30.11
[âœ“ PASS] æ€§èƒ½æµ‹è¯•
      FPS è‰¯å¥½ (30.11)
ä¿å­˜æœ€åä¸€å¸§: continuous_test_20251225_090317_640x480.jpg

============================================================
  æµ‹è¯•æ€»ç»“
============================================================
Video è®¾å¤‡æ£€æµ‹:   âœ“
OpenCV æ¨¡å¼:      âœ“
GStreamer æ¨¡å¼:   âœ—
æ€§èƒ½æµ‹è¯•:         âœ“
```

ğŸ”´ **GStreamer æµ‹è¯•å¤±è´¥**

**åŸå› åˆ†æ**ï¼š
- USB æ‘„åƒå¤´ä¸æ”¯æŒ `rkisp` æ’ä»¶ï¼ˆrkisp æ˜¯ RK3568 ISP ä¸“ç”¨çš„ï¼‰
- USB æ‘„åƒå¤´ä½¿ç”¨ UVC åè®®ï¼Œåº”è¯¥ç”¨æ ‡å‡†çš„ `v4l2src` æ’ä»¶
- ä½†å¯¹äºé—¨ç¦ç³»ç»Ÿï¼ŒOpenCV æ¨¡å¼çš„ 30 FPS å·²ç»è¶³å¤Ÿ

---

### 4.3 æœ€ç»ˆé…ç½®

#### ä¿®æ”¹ backend/config.py

```python
# æ‘„åƒå¤´é…ç½®
CAMERA_MODE = 'opencv'  # USB æ‘„åƒå¤´ä½¿ç”¨ OpenCV æ¨¡å¼
CAMERA_INDEX = 9        # USB CAMERA åœ¨ /dev/video9
CAMERA_WIDTH = 640
CAMERA_HEIGHT = 480
CAMERA_FPS = 30
```

---

## 5. æ•…éšœæ’æŸ¥æ€»ç»“

### 5.1 OV5695 å¤±è´¥åŸå› æ€»ç»“

| æ•…éšœç°è±¡ | æ’æŸ¥ç»“æœ | ç»“è®º |
|---------|---------|------|
| é©±åŠ¨æŠ¥é”™ï¼šsensor id(000000) | I2C é€šä¿¡å¤±è´¥ | ç¡¬ä»¶æ— å“åº” |
| i2cdetect æœªæ£€æµ‹åˆ° 0x36 | I2C æ€»çº¿æ‰«æå¤±è´¥ | ç‰©ç†è¿æ¥é—®é¢˜ |
| GPIO ç”µæºæ­£å¸¸ | vcc_camera = HIGH | ç”µæºæ§åˆ¶æ­£å¸¸ |
| è®¾å¤‡æ ‘é…ç½®æ­£å¸¸ | status = okay | è½¯ä»¶é…ç½®æ­£ç¡® |
| **æœ€ç»ˆåˆ¤å®š** | **ç¡¬ä»¶æ•…éšœ** | **æ‘„åƒå¤´æŸåæˆ–æ’çº¿é—®é¢˜** |

### 5.2 å…³é”®è¯Šæ–­å‘½ä»¤æ€»ç»“

```bash
# 1. æ£€æŸ¥è®¾å¤‡æ ‘
ls /sys/firmware/devicetree/base/i2c*/ov5695*
cat /sys/firmware/devicetree/base/i2c@fe5b0000/ov5695@36/status

# 2. æ£€æŸ¥é©±åŠ¨æ—¥å¿—
dmesg | grep ov5695

# 3. I2C æ€»çº¿æ‰«æï¼ˆæœ€å…³é”®ï¼‰
sudo i2cdetect -y 2

# 4. GPIO çŠ¶æ€
sudo cat /sys/kernel/debug/gpio

# 5. Video è®¾å¤‡
ls -l /dev/video*
v4l2-ctl --list-devices

# 6. USB è®¾å¤‡ï¼ˆUSB æ‘„åƒå¤´ï¼‰
lsusb
dmesg | grep -i usb
```

### 5.3 USB æ‘„åƒå¤´æ¥å…¥è¦ç‚¹

| æ­¥éª¤ | è¦ç‚¹ | å¸¸è§é—®é¢˜ |
|------|------|---------|
| 1. æ’å…¥ç¡¬ä»¶ | ä½¿ç”¨ USB 2.0/3.0 æ¥å£ | æŸäº›æ¥å£å¯èƒ½æ— ç”µ |
| 2. ç¡®è®¤è¯†åˆ« | `dmesg -w` å®æ—¶ç›‘æ§ | çœ‹åˆ° `uvcvideo: Found UVC` |
| 3. æŸ¥æ‰¾èŠ‚ç‚¹ | `v4l2-ctl --list-devices` | è®°å½• /dev/videoX |
| 4. æµ‹è¯• | `python3 test_camera.py --index X` | ä½¿ç”¨ OpenCV æ¨¡å¼ |
| 5. é…ç½® | `CAMERA_MODE = 'opencv'` | USB ä¸æ”¯æŒ GStreamer rkisp |

### 5.4 æ•…éšœå†³ç­–æ ‘

```
æ‘„åƒå¤´æ— æ³•å·¥ä½œ
    â†“
æ£€æŸ¥ dmesg | grep ov5695
    â”œâ”€ æœ‰ "Unexpected sensor id(000000)"
    â”‚    â†“
    â”‚  è¿è¡Œ i2cdetect -y 2
    â”‚    â”œâ”€ åœ°å€ 0x36 æ˜¾ç¤º --
    â”‚    â”‚    â†“
    â”‚    â”‚  ã€ç¡¬ä»¶æ•…éšœã€‘
    â”‚    â”‚  - æ£€æŸ¥æ’çº¿è¿æ¥
    â”‚    â”‚  - å°è¯•é‡æ–°æ’æ‹”
    â”‚    â”‚  - æ›´æ¢æ‘„åƒå¤´æˆ–åˆ‡æ¢åˆ° USB
    â”‚    â”‚
    â”‚    â””â”€ åœ°å€ 0x36 æ˜¾ç¤º 36 æˆ– UU
    â”‚         â†“
    â”‚       ã€é©±åŠ¨é…ç½®é—®é¢˜ã€‘
    â”‚       - æ£€æŸ¥è®¾å¤‡æ ‘
    â”‚       - æ£€æŸ¥ GPIO
    â”‚
    â””â”€ æ²¡æœ‰ ov5695 ç›¸å…³æ—¥å¿—
         â†“
       ã€é©±åŠ¨æœªåŠ è½½ã€‘
       - modprobe ov5695
       - æ£€æŸ¥å†…æ ¸é…ç½®
```

---

## 6. ç»éªŒæ•™è®­

### 6.1 ç¡¬ä»¶æ’æŸ¥é¡ºåº

1. âœ… **å…ˆæ£€æŸ¥è½¯ä»¶**ï¼šè®¾å¤‡æ ‘ã€é©±åŠ¨æ—¥å¿—
2. âœ… **å†æ£€æŸ¥é€šä¿¡**ï¼šI2C æ‰«æï¼ˆæœ€å…³é”®ï¼‰
3. âœ… **æœ€åæ£€æŸ¥ç¡¬ä»¶**ï¼šæ’çº¿ã€ç”µæºã€æ¨¡å—æœ¬èº«

### 6.2 I2C æ‰«æçš„é‡è¦æ€§

**`i2cdetect` æ˜¯ç¡¬ä»¶é—®é¢˜çš„é‡‘æ ‡å‡†**ï¼š
- å¦‚æœæ‰«æåˆ°è®¾å¤‡ï¼ˆæ˜¾ç¤ºåœ°å€æˆ– UUï¼‰â†’ ç¡¬ä»¶æ­£å¸¸ï¼Œæ’æŸ¥è½¯ä»¶
- å¦‚æœæ‰«æä¸åˆ°ï¼ˆæ˜¾ç¤º --ï¼‰â†’ ç¡¬ä»¶é—®é¢˜ï¼Œæ£€æŸ¥è¿æ¥æˆ–æ›´æ¢

### 6.3 USB æ‘„åƒå¤´çš„ä¼˜åŠ¿

| å¯¹æ¯”é¡¹ | MIPI æ‘„åƒå¤´ï¼ˆOV5695ï¼‰ | USB æ‘„åƒå¤´ |
|-------|---------------------|-----------|
| æ¥å£ | MIPI-CSI | USB 2.0/3.0 |
| é©±åŠ¨ | éœ€è¦è®¾å¤‡æ ‘é…ç½® | å…é©±ï¼ˆUVCï¼‰ |
| è°ƒè¯•éš¾åº¦ | é«˜ï¼ˆæ¶‰åŠ I2Cã€GPIOã€ISPï¼‰ | ä½ï¼ˆå³æ’å³ç”¨ï¼‰ |
| æ€§èƒ½ | é«˜ï¼ˆç¡¬ä»¶ ISPï¼‰ | ä¸­ï¼ˆCPU è½¯è§£ï¼‰ |
| æ•…éšœç‡ | é«˜ï¼ˆæ’çº¿ã€æ¥å£æ˜“æŸï¼‰ | ä½ï¼ˆæ ‡å‡†æ¥å£ï¼‰ |
| é€‚ç”¨åœºæ™¯ | åµŒå…¥å¼äº§å“ | å¿«é€ŸåŸå‹ã€å¼€å‘è°ƒè¯• |

---

## 7. æœ€ç»ˆéƒ¨ç½²é…ç½®

```python
# backend/config.py

# æ‘„åƒå¤´æ¨¡å¼ï¼šOpenCVï¼ˆUSB æ‘„åƒå¤´ï¼‰
CAMERA_MODE = 'opencv'

# è®¾å¤‡ç´¢å¼•ï¼š9 (USB CAMERA)
CAMERA_INDEX = 9

# åˆ†è¾¨ç‡ï¼šVGA (æ€§èƒ½ä¸ç”»è´¨å¹³è¡¡)
CAMERA_WIDTH = 640
CAMERA_HEIGHT = 480
CAMERA_FPS = 30

# å¤‡ç”¨ç´¢å¼•ï¼ˆå¦‚æœ video9 å¤±è´¥ï¼‰
CAMERA_FALLBACK_INDICES = [9, 10]
```

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
# å¯åŠ¨ç³»ç»Ÿ
python -m uvicorn backend.main:app --host 0.0.0.0 --port 8000

# è®¿é—®è§†é¢‘æµ
curl http://192.168.50.1:8000/api/video_stream

# æµ‹è¯•äººè„¸å½•å…¥
# æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.50.1:8000
```

---

## 8. å‚è€ƒèµ„æ–™

- RK3568 å®˜æ–¹æ–‡æ¡£
- OV5695 æ•°æ®æ‰‹å†Œ
- Linux UVC é©±åŠ¨æ–‡æ¡£
- V4L2 API å‚è€ƒ
- é¡¹ç›®æ–‡æ¡£ï¼š
  - `docs/RK3568å¼€å‘æ¿é…ç½®æŒ‡å—.md`
  - `docs/backend/ov5695æ¥å…¥æ–‡æ¡£.md`

---

**ç»“è®º**ï¼šé€šè¿‡ç³»ç»Ÿæ€§çš„ç¡¬ä»¶æ’æŸ¥ï¼Œç¡®å®š OV5695 æ‘„åƒå¤´ç¡¬ä»¶æ•…éšœï¼ŒæˆåŠŸåˆ‡æ¢åˆ° USB æ‘„åƒå¤´æ–¹æ¡ˆï¼Œå®ç°äº†ç¨³å®šçš„ 30 FPS è§†é¢‘é‡‡é›†ã€‚


**å¼€å‘äººå‘˜**ï¼šJuyao Huang
**å¼€å‘æ—¶é—´**ï¼š25/12/2025

